var formSelector=document.getElementById("mainForm");document.getElementById("files").addEventListener("change",handleFileSelect,!1);var form=document.querySelector("form");form.addEventListener("submit",formdataToExif);let tagsToShow=[271,272,40091,40092,40093,40094,40095,282,283,305,306,323,37377,37380,37386,37387,2,4,6,12,17];function handleFileSelect(evt){file=evt.target.files[0];var reader=new FileReader;reader.onloadend=function(e){var exifObj=piexif.load(e.target.result);for(let i in tagsToShow)showForm(tagsToShow[i],exifObj);submitButton()},reader.readAsDataURL(file)}let showForm=function(tag,exifObj){let exifName;null!=piexif.TAGS["0th"][tag]?(exifName=null==exifObj["0th"][tag]?"":exifObj["0th"][tag],piexif.TAGS["0th"][tag].name.startsWith("XP")&&(exifName=toXPHandler(exifName),exifName=(new TextDecoder).decode(Uint8Array.from(exifName))),showData(piexif.TAGS["0th"][tag].name,exifName),console.log("0th",piexif.TAGS["0th"][tag].name,piexif.TAGS["0th"][tag].type,exifName)):null!=piexif.TAGS.GPS[tag]?(exifName=null==exifObj.GPS[tag]?"":exifObj.GPS[tag],showData(piexif.TAGS.GPS[tag].name,exifName),console.log("GPS",piexif.TAGS.GPS[tag].name,piexif.TAGS.GPS[tag].type,exifName)):null!=piexif.TAGS.Exif[tag]?(exifName=null==exifObj.Exif[tag]?"":exifObj.Exif[tag],showData(piexif.TAGS.Exif[tag].name,exifName),console.log("Exif",piexif.TAGS.Exif[tag].name,piexif.TAGS.Exif[tag].type,exifName)):console.log(tag)};function showData(labelOfInput,valueOfInput){var newNode=document.createElement("label");newNode.setAttribute("for",""+labelOfInput),newNode.textContent=labelOfInput,formSelector.appendChild(newNode),formSelector.appendChild(document.createElement("br"));var newInput=document.createElement("input");newInput.type="text",newInput.setAttribute("value",""+valueOfInput),newInput.setAttribute("name",labelOfInput),formSelector.appendChild(newInput),formSelector.appendChild(document.createElement("br"))}function submitButton(){let br=document.createElement("br");formSelector.appendChild(br);var download=document.createElement("input");download.type="submit",download.setAttribute("value","Download The Image"),download.setAttribute("name","submit"),formSelector.appendChild(download)}function toXPHandler(arrOfAscii){for(var newArr=[],i=0;i<arrOfAscii.length-2;i++)i%2==0&&newArr.push(arrOfAscii[i]);return newArr}function formdataToExif(e){e.preventDefault();var formData=new FormData(e.target),zeroth={},exif={},gps={};zeroth[piexif.ImageIFD.Make]="dftre",zeroth[piexif.ImageIFD.XResolution]=[777,1],zeroth[piexif.ImageIFD.YResolution]=[777,1],zeroth[piexif.ImageIFD.Software]="Piexifjs",zeroth[piexif.ImageIFD.XPTitle]=[70,0,69,0,69,0,69,0,32,0,67,0,66,0,68,0,69,0,32,0,67,0,65,0,77,0,67,0,0,0],zeroth[piexif.ImageIFD.XPComment]=[70,0,69,0,69,0,69,0,32,0,67,0,66,0,68,0,69,0,32,0,67,0,65,0,77,0,67,0,0,0],zeroth[piexif.ImageIFD.XPAuthor]=[70,0,69,0,69,0,69,0,32,0,67,0,66,0,68,0,69,0,32,0,67,0,65,0,77,0,67,0,0,0],zeroth[piexif.ImageIFD.XPKeyword]=[70,0,69,0,69,0,69,0,32,0,67,0,66,0,68,0,69,0,32,0,67,0,65,0,77,0,67,0,0,0],zeroth[piexif.ImageIFD.XPSubject]=[70,0,69,0,69,0,69,0,32,0,67,0,66,0,68,0,69,0,32,0,67,0,65,0,77,0,67,0,0,0],zeroth[piexif.ImageIFD.DateTime]="2010:10:10 10:10:10",zeroth[piexif.ImageIFD.TileLength]=100,zeroth[piexif.ImageIFD.FlashEnergy]=0,zeroth[piexif.ImageIFD.Model]="Piexif",exif[piexif.ExifIFD.ShutterSpeedValue]=[42,2],exif[piexif.ExifIFD.ExposureBiasValue]=[1,100],exif[piexif.ExifIFD.FocalLength]=[22,22],gps[piexif.GPSIFD.GPSLatitude]=[[1,1],[1,1],[1,1]],gps[piexif.GPSIFD.GPSLongitude]=[[1,1],[1,1],[1,1]],gps[piexif.GPSIFD.GPSAltitude]=[[1,1],[1,1],[1,1]],gps[piexif.GPSIFD.GPSSpeedRef]="K";var exifObj={"0th":zeroth,Exif:exif,GPS:gps},exifbytes=piexif.dump(exifObj),reader=new FileReader;reader.onload=function(e){var inserted=piexif.insert(exifbytes,e.target.result),el=document.createElement("img");el.setAttribute("src",inserted),el.setAttribute("style","hight:100px; width:100px"),formSelector.appendChild(el)},reader.readAsDataURL(file)}